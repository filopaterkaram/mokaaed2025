<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ù‚Ø§Ø¹Ø¯ Ù…Ø³Ø±Ø­ Ø§Ù„ÙˆØ§ÙŠ (Ù†ÙŠØ±ÙˆØ² 2025)</title>
    <!-- Firebase App (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©) -->
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>




    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        #bg-anim {
            position: fixed;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            pointer-events: none;
            opacity: 0.25;
            transition: opacity 0.5s;
        }
        :root {
            --main-bg: #fff;
            --main-color: #222;
            --section-bg: #f7f7f7;
            --section-title: #d4a900;
            --seat-bg: linear-gradient(135deg, #fffbe6 0%, #ffe066 100%);
            --seat-color: #222;
            --seat-hover-bg: linear-gradient(135deg, #ffe066 0%, #fffbe6 100%);
            --btn-bg: #ffd700;
            --btn-color: #222;
            --btn-hover-bg: #ffb347;
            --dark-bg: linear-gradient(135deg, #18191a 0%, #232526 100%);
            --dark-main-color: #eee;
            --dark-section-bg: rgba(40,40,40,0.7);
            --dark-section-title: #ffb347;
            --dark-seat-bg: linear-gradient(135deg, #444 0%, #222 100%);
            --dark-seat-color: #ffd700;
            --dark-seat-hover-bg: linear-gradient(135deg, #222 0%, #444 100%);
        }
        body {
            background: var(--main-bg);
            font-family: 'Cairo', Arial, sans-serif;
            color: var(--main-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            transition: background 0.7s cubic-bezier(.4,2,.6,1), color 0.5s;
        }
        body.dark {
            background: var(--dark-bg);
            color: var(--dark-main-color);
        }
        h1, h2 {
            text-align: center;
            margin: 30px auto;
            letter-spacing: 1px;
            font-size: 2.2rem;
            transition: color 0.5s;
            z-index: 10;
            position: relative;
        }
        h2 {
            font-size: 1.8rem;
        }
        .sections {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        .section {
            background: var(--section-bg);
            border-radius: 18px;
            padding: 24px 18px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.1);
            min-width: 260px;
            transition: transform 0.3s, background 0.5s, box-shadow 0.3s;
            z-index: 5;
        }
        body.dark .section {
            background: var(--dark-section-bg);
        }
        .section:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        .section-title {
            font-size: 1.4rem;
            margin-bottom: 18px;
            text-align: center;
            letter-spacing: 1px;
            color: var(--section-title);
            transition: color 0.5s;
        }
        body.dark .section-title {
            color: var(--dark-section-title);
        }
        .seats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .seat {
            background: var(--seat-bg);
            color: var(--seat-color);
            border-radius: 8px;
            padding: 10px 8px;
            min-width: 60px;
            text-align: center;
            margin-bottom: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: background 0.2s, transform 0.2s, color 0.5s;
            position: relative;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        body.dark .seat {
            background: var(--dark-seat-bg);
            color: var(--dark-seat-color);
        }
        .seat:hover {
            background: var(--seat-hover-bg);
            transform: scale(1.07) rotate(-2deg);
        }
        body.dark .seat:hover {
            background: var(--dark-seat-hover-bg);
        }
        .seat .owner {
            display: block;
            font-size: 0.85em;
            color: #444;
            margin-top: 2px;
            font-weight: 400;
        }
        body.dark .seat .owner {
            color: #ffd700;
        }
        .icon-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            padding: 14px;
            cursor: pointer;
            transition: transform 0.25s, box-shadow 0.25s, background 0.3s, color 0.3s;
        }
        .icon-btn .icon {
            font-size: 1.4em;
        }
        .theme-toggle {
            position: fixed;
            left: 18px;
            top: 18px;
            z-index: 2000;
            background: #fff;
            color: #222;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.13);
            cursor: pointer;
            font-size: 1.7em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s, color 0.3s, transform 0.3s;
        }
        .theme-toggle:hover {
            background: #ffd700;
            color: #222;
            transform: scale(1.1) rotate(360deg);
        }
        .page {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            width: 100%;
            position: relative;
            z-index: 10;
            padding: 20px;
            box-sizing: border-box;
        }
        #sidebar {
            position: fixed; right: 0; top: 0; height: 100vh; width: 70px;
            background: rgba(34,34,34,0.97); z-index: 3000;
            display: flex; flex-direction: column; align-items: center;
            padding-top: 80px; gap: 10px;
            box-shadow: -2px 0 12px rgba(0,0,0,0.13);
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(.6,-0.3,.3,1.3), width 0.35s;
        }
        #sidebar.sidebar-shown {
            transform: translateX(0);
        }
        #sidebar.sidebar-hidden {
            transform: translateX(100%);
        }
        #sidebar:hover {
            width: 220px;
        }
        #sidebar .sidebar-btn {
            width: 90%; min-width: 44px; height: 44px; display: flex;
            align-items: center; gap: 12px; justify-content: flex-start;
            background: none; border: none; color: #ffd700;
            font-size: 1.2em; border-radius: 8px; margin: 0 0 6px 0;
            cursor: pointer; padding: 0 10px; overflow: hidden;
            transition: background 0.2s, color 0.2s;
        }
        #sidebar .sidebar-btn .icon { font-size: 1.5em; min-width: 32px; text-align: center; }
        #sidebar .sidebar-label {
            opacity: 0; max-width: 0; white-space: nowrap; overflow: hidden;
            color: #ffd700; font-size: 1em; font-weight: bold;
            transition: opacity 0.3s 0.1s, max-width 0.3s 0.1s;
        }
        #sidebar:hover .sidebar-label { opacity: 1; max-width: 150px; margin-right: 8px; }
        #sidebar .sidebar-btn:hover { background: #ffd70033; color: #fff; }
        #sidebarToggleBtn {
            position:fixed; right:18px; top:18px; z-index:3500; background:#ffd700;
            color:#222; border:none; border-radius:10px; width:48px; height:48px;
            display:flex; align-items:center; justify-content:center; font-size:2em;
            box-shadow:0 2px 8px rgba(0,0,0,0.13); cursor:pointer;
            transition: background 0.3s, transform 0.3s;
        }
        #sidebarToggleBtn:hover { background: #ffb347; transform: scale(1.1); }
        #mainMenuPage > div {
            flex-direction: row !important; gap: 18px; justify-content: center;
            align-items: center; flex-wrap: wrap;
            animation: fadeInRight 0.7s cubic-bezier(.4,2,.6,1);
        }
        #mainMenuPage button.icon-btn:hover {
            transform: scale(1.08) rotate(-2deg);
            box-shadow: 0 6px 24px #ffd70055;
            background: #fffbe6 !important; color: #222 !important;
        }
        @keyframes fadeInRight {
            from { opacity:0; transform:translateX(60px); }
            to { opacity:1; transform:translateX(0); }
        }
        @media print {
            body * { display: none !important; }
            #logTableContainer, #logTableContainer * { display: block !important; }
        }
        
        /* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ */
        .seat-management {
            display: flex;
            gap: 18px;
            margin-bottom: 18px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .seat-management div {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
        }
        .seat-management button {
            background: #ffd700;
            color: #222;
            border: none;
            border-radius: 5px;
            padding: 4px 10px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 4px;
        }
        .seat-management button.remove {
            background: #b00;
            color: #fff;
        }
        .seat-table {
            width: 100%;
            max-width: 800px;
            border-collapse: collapse;
            direction: rtl;
            background: rgba(255,255,255,0.07);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 18px;
        }
        .seat-table th {
            background: #ffd700;
            color: #222;
            font-weight: bold;
            padding: 8px;
        }
        .seat-table td {
            padding: 8px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        .seat-table tr:last-child td {
            border-bottom: none;
        }
        .deleteSeatBtn {
            background: #b00;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 4px 10px;
            cursor: pointer;
        }
        
        /* Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .form-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 300px;
            margin-bottom: 18px;
            background: rgba(255,255,255,0.05);
            padding: 18px;
            border-radius: 12px;
        }
        .form-container input, 
        .form-container select, 
        .form-container button {
            padding: 8px;
            border-radius: 6px;
            border: none;
            font-size: 1em;
        }
        .form-container button {
            background: var(--btn-bg);
            color: var(--btn-color);
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        .form-container button:hover {
            background: var(--btn-hover-bg);
        }
        
        /* Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« */
        .result-container {
            width: 100%;
            max-width: 800px;
            min-height: 40px;
            margin-bottom: 18px;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            direction: rtl;
        }
        .result-table th {
            background: #ffd700;
            color: #222;
            font-weight: bold;
            padding: 8px;
            border: 1px solid #ccc;
        }
        .result-table td {
            padding: 8px;
            border: 1px solid #ccc;
        }
        
        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³Ø¬Ù„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: #fff;
            color: #222;
            border-radius: 12px;
            padding: 24px 18px;
            min-width: 320px;
            max-width: 90vw;
            max-height: 80vh;
            overflow: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            position: relative;
        }
        .modal-close {
            position: absolute;
            left: 12px;
            top: 12px;
            background: #ffd700;
            color: #333;
            border: none;
            border-radius: 6px;
            padding: 4px 14px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
        body.font-small { font-size: 13px; }
        body.font-medium { font-size: 16px; }
        body.font-large { font-size: 20px; }
        
        @media (max-width: 900px) {
            #mainMenuPage > div { flex-direction: column !important; }
            .sections { flex-direction: column; align-items: center; gap: 24px; }
            .seat-management { flex-direction: column; align-items: center; }
        }
        @media (max-width: 700px) {
            #sidebar { width: 54px; }
            #sidebar .sidebar-btn { width:36px; height:36px; font-size:1.3em; }
        }
    </style>
</head>
<body>
    <canvas id="bg-anim"></canvas>

    <button id="themeToggleBtn" class="theme-toggle" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ…"><span id="themeIcon">ğŸŒ™</span></button>
    <button id="sidebarToggleBtn">
        <svg viewBox="0 0 32 32" width="28" height="28"><rect y="5" width="32" height="4" rx="2" fill="currentColor"/><rect y="14" width="32" height="4" rx="2" fill="currentColor"/><rect y="23" width="32" height="4" rx="2" fill="currentColor"/></svg>
    </button>
    
    <div id="sidebar" class="sidebar-hidden">
        <button class="sidebar-btn" id="sidebarMenuBtn" title="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…"><span class="icon">ğŸ </span><span class="sidebar-label">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span></button>
        <button class="sidebar-btn" id="sidebarSeatsBtn" title="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ"><span class="icon">ğŸª‘</span><span class="sidebar-label">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ</span></button>
        <button class="sidebar-btn" id="sidebarBookingBtn" title="Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª"><span class="icon">ğŸŸï¸</span><span class="sidebar-label">Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</span></button>
        <button class="sidebar-btn" id="sidebarTicketsBtn" title="Ø¨ÙŠØ¹ Ø§Ù„ØªØ°Ø§ÙƒØ±"><span class="icon">ğŸªª</span><span class="sidebar-label">Ø¨ÙŠØ¹ Ø§Ù„ØªØ°Ø§ÙƒØ±</span></button>
        <button class="sidebar-btn" id="sidebarInquiryBtn" title="Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª"><span class="icon">ğŸ”</span><span class="sidebar-label">Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª</span></button>
        <button class="sidebar-btn" id="sidebarAttendanceBtn" title="Ø§Ù„Ø­Ø¶ÙˆØ±/Ø§Ù„Ø§Ù†ØµØ±Ø§Ù"><span class="icon">ğŸ•’</span><span class="sidebar-label">Ø§Ù„Ø­Ø¶ÙˆØ±/Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</span></button>
        <button class="sidebar-btn" id="sidebarAdminBtn" title="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©"><span class="icon">âš™ï¸</span><span class="sidebar-label">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span></button>
        <div style="flex:1"></div>
        <button class="sidebar-btn" id="sidebarLogoutBtn" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"><span class="icon">ğŸšª</span><span class="sidebar-label">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span></button>
    </div>

    <div id="loginPage" class="page" style="display: flex;">
        <h1>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
        <form id="loginForm" style="display: flex; flex-direction: column; gap: 12px; min-width: 260px;">
            <input type="text" id="usernameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required style="padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 1.1em;">
            <input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required style="padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 1.1em;">
            <button type="submit" class="icon-btn" style="background: #ffd700; color: #333;">Ø¯Ø®ÙˆÙ„</button>
            <div id="loginError" style="color: #ff4444; text-align: center; display: none; margin-top: 10px;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
        </form>
    </div>

    <div id="mainMenuPage" class="page">
        <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
        <div style="display:flex; flex-direction:column; gap:18px; margin:40px 0; min-width:260px;">
            <button id="goSeatManageBtn" class="icon-btn" style="background:#ffd700; color:#333;"><span class="icon">ğŸª‘</span> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ</button>
            <button id="goBookingBtn" class="icon-btn" style="background:#ffd700; color:#333;"><span class="icon">ğŸŸï¸</span> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</button>
            <button id="goInquiryBtn" class="icon-btn" style="background:#ffb347; color:#333;"><span class="icon">ğŸ”</span> Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯</button>
            <button id="goTicketsBtn" class="icon-btn" style="background:#ffd700; color:#333;"><span class="icon">ğŸªª</span> Ø¨ÙŠØ¹ ØªØ°Ø§ÙƒØ±</button>
            <button id="goAttendanceBtn" class="icon-btn" style="background:#ffb347; color:#333;"><span class="icon">ğŸ•’</span> Ø¯Ø®ÙˆÙ„/Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ø£ÙØ±Ø§Ø¯</button>
            <button id="goAdminBtn" class="icon-btn" style="background:#222; color:#ffd700;"><span class="icon">âš™ï¸</span> Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
        </div>
        <button id="logoutBtnMainMenu" class="icon-btn" style="background: #444; color: #fff; padding: 10px 20px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="sectionSelectPage" class="page">
        <h1>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</h1>
        <div id="sectionBtns" style="display: flex; gap: 24px; margin: 32px 0;"></div>
        <button id="backToMenuFromSectionSelect" class="icon-btn" style="background: #444; color: #fff; margin-top: 20px;">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    </div>

    <div id="mainPage" class="page">
        <h1 id="mainTitle"></h1>
        <button id="showLogBtn" class="icon-btn" style="background: #ffd700; color: #333; margin-bottom: 18px;"><span class="icon">ğŸ“‹</span> Ø³Ø¬Ù„ Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ</button>
        <div class="sections" id="sections"></div>
        <form id="addSeatForm" class="form-container">
            <input type="number" id="seatNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ" min="1" required>
            <input type="text" id="ownerName" placeholder="Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„ÙƒØ±Ø³ÙŠ" required>
            <input type="text" id="mobileNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" required pattern="[0-9]+" title="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
            <button type="submit" class="icon-btn"><span class="icon">â•</span> Ø¥Ø¶Ø§ÙØ© ÙƒØ±Ø³ÙŠ</button>
        </form>
        <div style="display: flex; justify-content: center; gap: 16px; margin-top: 18px;">
            <button id="backToSectionsBtn" class="icon-btn" style="background: #444; color: #fff;">Ø±Ø¬ÙˆØ¹ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù…</button>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø³Ø¬Ù„ Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ -->
    <div id="logModal" class="modal">
        <div class="modal-content">
            <button id="closeLogBtn" class="modal-close">Ø¥ØºÙ„Ø§Ù‚</button>
            <h2>Ø³Ø¬Ù„ Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©</h2>
            <div id="logTableContainer"></div>
            <button id="exportPdfBtn" class="icon-btn" style="background: #ffd700; color: #333; margin: 18px auto 0; display: block;">ØªØµØ¯ÙŠØ± PDF</button>
        </div>
    </div>
    
    <div id="adminPage" class="page">
        <h1><span class="icon">âš™ï¸</span> Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
        <form id="addUserForm" class="form-container">
            <input type="text" id="newUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯" required>
            <input type="password" id="newPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
            <div id="adminSectionsCheckboxes" style="display:flex; gap:10px; color: var(--dark-main-color);"></div>
            <div id="adminPermissionsCheckboxes" style="display:flex; flex-wrap:wrap; gap:10px; color: var(--dark-main-color); margin-top:8px;"></div>
            <button type="submit" class="icon-btn"><span class="icon">â•</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
        </form>
        <div id="usersTableContainer" style="width:100%; max-width:800px; margin-bottom:18px;"></div>
        <button id="backToMenuFromAdmin" class="icon-btn" style="background: #444; color: #fff; margin-top:18px;"><span class="icon">ğŸ </span> Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    </div>

    <div id="seatManagePage" class="page">
        <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ</h1>
        <div class="seat-management">
            <div>
                <span style="font-weight:bold;">Ù‚Ø³Ù… A:</span>
                <button id="addSeatA">â• ÙƒØ±Ø³ÙŠ</button>
                <button id="removeSeatA" class="remove">â– ÙƒØ±Ø³ÙŠ</button>
                <span id="countA"></span>
            </div>
            <div>
                <span style="font-weight:bold;">Ù‚Ø³Ù… B:</span>
                <button id="addSeatB">â• ÙƒØ±Ø³ÙŠ</button>
                <button id="removeSeatB" class="remove">â– ÙƒØ±Ø³ÙŠ</button>
                <span id="countB"></span>
            </div>
            <div>
                <span style="font-weight:bold;">Ù‚Ø³Ù… C:</span>
                <button id="addSeatC">â• ÙƒØ±Ø³ÙŠ</button>
                <button id="removeSeatC" class="remove">â– ÙƒØ±Ø³ÙŠ</button>
                <span id="countC"></span>
            </div>
        </div>
        <form id="addSeatManualForm" class="form-container" style="flex-direction: row; flex-wrap: wrap;">
            <input type="number" id="manualSeatNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ" min="1" max="20" required>
            <input type="text" id="manualOwnerName" placeholder="Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„ÙƒØ±Ø³ÙŠ" required>
            <input type="text" id="manualMobileNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" required pattern="[0-9]+" title="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
            <select id="manualSection" required>
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
            </select>
            <button type="submit">Ø¥Ø¶Ø§ÙØ© ÙƒØ±Ø³ÙŠ</button>
        </form>
        <div id="seatManageTableContainer" class="result-container"></div>
        <button id="exportSeatsPdfBtn" class="icon-btn" style="background: #ffd700; color: #333; margin-bottom: 12px;">ØªØµØ¯ÙŠØ± PDF</button>
        <button id="backToMenuFromSeats" class="icon-btn" style="background: #444; color: #fff;">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    </div>
    
    <div id="inquiryPage" class="page">
        <h1>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù…Ù‚Ø¹Ø¯ Ø£Ùˆ Ø´Ø®Øµ</h1>
        <form id="inquiryForm" class="form-container" style="flex-direction: row; flex-wrap: wrap;">
            <input type="text" id="inquiryInput" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ Ø£Ùˆ Ø§Ø³Ù… Ø£Ùˆ Ù…ÙˆØ¨Ø§ÙŠÙ„">
            <button type="submit">Ø¨Ø­Ø«</button>
        </form>
        <div id="inquiryResult" class="result-container"></div>
        <button id="backToMenuFromInquiry" class="icon-btn" style="background: #444; color: #fff; margin-top:18px;">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    </div>
    
    <div id="ticketsPage" class="page">
        <h1>Ø¨ÙŠØ¹ Ø§Ù„ØªØ°Ø§ÙƒØ±</h1>
        <form id="sellTicketForm" class="form-container">
            <input type="text" id="ticketBuyerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠ" required>
            <input type="text" id="ticketBuyerMobile" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" required>
            <select id="ticketSection" required>
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
            </select>
            <select id="ticketSeatNumber" required>
                <option value="">Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ</option>
            </select>
            <button type="submit">Ø¨ÙŠØ¹ ØªØ°ÙƒØ±Ø©</button>
        </form>
        <div id="ticketResult" class="result-container"></div>
        <button id="backToMenuFromTickets" class="icon-btn" style="background: #444; color: #fff; margin-top:18px;">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    </div>
    
    <div id="attendancePage" class="page">
        <h1>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„/Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ø£ÙØ±Ø§Ø¯</h1>
        <form id="attendanceForm" class="form-container" style="flex-direction: row; flex-wrap: wrap;">
            <input type="text" id="attendanceName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
            <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„/Ø§Ù†ØµØ±Ø§Ù</button>
        </form>
        <div id="attendanceResult" class="result-container"></div>
        <button id="backToMenuFromAttendance" class="icon-btn" style="background: #444; color: #fff; margin-top:18px;">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    </div>

    <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA3V2v_T5tnkEzGI6EcfxO_lJo-diY9nG4",
      authDomain: "mokaaed2025.firebaseapp.com",
      databaseURL: "https://mokaaed2025-default-rtdb.firebaseio.com",
      projectId: "mokaaed2025",
      storageBucket: "mokaaed2025.firebasestorage.app",
      messagingSenderId: "731507668899",
      appId: "1:731507668899:web:4f450332344d0bcb638c16",
      measurementId: "G-8DHVLLJ5GP"
    };
    firebase.initializeApp(firebaseConfig);
    document.addEventListener('DOMContentLoaded', () => {
        firebase.database().ref("chairs").once("value").then(snapshot => {
  const allChairs = snapshot.val();
  if (allChairs) {
    Object.keys(allChairs).forEach(seatId => {
      const data = allChairs[seatId];
      const seatElement = document.getElementById(seatId);
      if (data.status === "reserved" && seatElement) {
        seatElement.classList.add("reserved");
        seatElement.style.pointerEvents = "none"; // ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø­Ø¬Ø² Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
      }
    });
  }
});

        // ===================================
        // Animated Background Logic
        // ===================================
        const canvas = document.getElementById('bg-anim');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let particlesArray;

        class Particle {
            constructor(x, y, directionX, directionY, size) {
                this.x = x; this.y = y; this.directionX = directionX;
                this.directionY = directionY; this.size = size;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false);
                ctx.fillStyle = document.body.classList.contains('dark') ? '#ffd700' : '#444444';
                ctx.fill();
            }
            update() {
                if (this.x > canvas.width || this.x < 0) { this.directionX = -this.directionX; }
                if (this.y > canvas.height || this.y < 0) { this.directionY = -this.directionY; }
                this.x += this.directionX;
                this.y += this.directionY;
                this.draw();
            }
        }

        function init() {
            particlesArray = [];
            let numberOfParticles = (canvas.height * canvas.width) / 11000;
            for (let i = 0; i < numberOfParticles; i++) {
                let size = (Math.random() * 1.5) + 1;
                let x = (Math.random() * ((innerWidth - size * 2) - (size * 2)) + size * 2);
                let y = (Math.random() * ((innerHeight - size * 2) - (size * 2)) + size * 2);
                let directionX = (Math.random() * .4) - 0.2;
                let directionY = (Math.random() * .4) - 0.2;
                particlesArray.push(new Particle(x, y, directionX, directionY, size));
            }
        }
        
        function animate() {
            requestAnimationFrame(animate);
            ctx.clearRect(0,0,innerWidth, innerHeight);
            for (let i = 0; i < particlesArray.length; i++) { particlesArray[i].update(); }
        }

        window.addEventListener('resize', () => {
            canvas.width = innerWidth;
            canvas.height = innerHeight;
            init();
        });
        
        init();
        animate();

        // ===================================
        // App Core Logic
        // ===================================

        // Page Elements
        const pages = document.querySelectorAll('.page');
        const loginPage = document.getElementById('loginPage');
        const mainMenuPage = document.getElementById('mainMenuPage');
        const sectionSelectPage = document.getElementById('sectionSelectPage');
        const mainPage = document.getElementById('mainPage');
        const adminPage = document.getElementById('adminPage');
        const seatManagePage = document.getElementById('seatManagePage');
        const inquiryPage = document.getElementById('inquiryPage');
        const ticketsPage = document.getElementById('ticketsPage');
        const attendancePage = document.getElementById('attendancePage');
        const logModal = document.getElementById('logModal');

        // --- Theme ---
        const themeToggleBtn = document.getElementById('themeToggleBtn');
        const themeIcon = document.getElementById('themeIcon');
        function setTheme(mode) {
            if (mode === 'dark') {
                document.body.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                themeIcon.textContent = 'â˜€ï¸';
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                themeIcon.textContent = 'ğŸŒ™';
            }
            // Redraw canvas with new color
            init();
        }
        themeToggleBtn.onclick = () => setTheme(document.body.classList.contains('dark') ? 'light' : 'dark');
        setTheme(localStorage.getItem('theme') || 'light');

        // --- Sidebar ---
        const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
        const sidebar = document.getElementById('sidebar');
        sidebarToggleBtn.onclick = () => {
            sidebar.classList.toggle('sidebar-shown');
            sidebar.classList.toggle('sidebar-hidden');
        };
        document.querySelectorAll('.sidebar-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (window.innerWidth < 700) {
                    sidebar.classList.remove('sidebar-shown');
                    sidebar.classList.add('sidebar-hidden');
                }
            });
        });

        // --- Data ---
        const USERS = {
            'filo': { password: '123', section: ['A', 'B', 'C'], permissions: ['booking', 'tickets', 'inquiry', 'attendance', 'admin', 'seat_manage'] },
            'userb': { password: 'bpass', section: ['B'], permissions: ['booking', 'inquiry'] },
        };
        const PERMISSIONS = [
            { key: 'booking', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª' },
            { key: 'tickets', label: 'Ø¨ÙŠØ¹ Ø§Ù„ØªØ°Ø§ÙƒØ±' },
            { key: 'inquiry', label: 'Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª' },
            { key: 'attendance', label: 'Ø§Ù„Ø­Ø¶ÙˆØ±/Ø§Ù„Ø§Ù†ØµØ±Ø§Ù' },
            { key: 'admin', label: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©' },
            { key: 'seat_manage', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ' }
        ];
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ Ù„ÙƒÙ„ Ù‚Ø³Ù…
        const seatsData = {
            A: Array.from({length: 20}, (_, i) => ({ number: i + 1, owner: '', mobile: '', bookedAt: '', leftAt: '' })),
            B: Array.from({length: 20}, (_, i) => ({ number: i + 1, owner: '', mobile: '', bookedAt: '', leftAt: '' })),
            C: Array.from({length: 20}, (_, i) => ({ number: i + 1, owner: '', mobile: '', bookedAt: '', leftAt: '' })),
        };
        
        let currentUser = null;
        let currentSection = null;
        let ticketSerial = 1;
        const soldTickets = [];
        const attendanceLog = [];

        // --- Navigation ---
        function hideAllPages() {
            pages.forEach(p => p.style.display = 'none');
        }

        function showPage(page) {
            hideAllPages();
            page.style.display = 'flex';
        }

        // --- Login/Logout ---
        const loginForm = document.getElementById('loginForm');
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('usernameInput').value.trim();
            const password = document.getElementById('passwordInput').value;
            if (USERS[username] && USERS[username].password === password) {
                currentUser = { username, ...USERS[username] };
                document.getElementById('loginForm').reset();
                document.getElementById('loginError').style.display = 'none';
                updateMenuPermissions();
                showPage(mainMenuPage);
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        });

        function logout() {
            currentUser = null;
            currentSection = null;
            showPage(loginPage);
            sidebar.classList.remove('sidebar-shown');
            sidebar.classList.add('sidebar-hidden');
        }
        document.getElementById('logoutBtnMainMenu').addEventListener('click', logout);
        document.getElementById('sidebarLogoutBtn').addEventListener('click', logout);

        // --- Permissions ---
        function updateMenuPermissions() {
            if (!currentUser) return;
            const perms = currentUser.permissions;
            document.getElementById('goBookingBtn').style.display = perms.includes('booking') ? 'flex' : 'none';
            document.getElementById('goTicketsBtn').style.display = perms.includes('tickets') ? 'flex' : 'none';
            document.getElementById('goInquiryBtn').style.display = perms.includes('inquiry') ? 'flex' : 'none';
            document.getElementById('goAttendanceBtn').style.display = perms.includes('attendance') ? 'flex' : 'none';
            document.getElementById('goAdminBtn').style.display = perms.includes('admin') ? 'flex' : 'none';
            document.getElementById('goSeatManageBtn').style.display = perms.includes('seat_manage') ? 'flex' : 'none';
            
            // Sidebar buttons
            document.getElementById('sidebarBookingBtn').style.display = perms.includes('booking') ? 'flex' : 'none';
            document.getElementById('sidebarTicketsBtn').style.display = perms.includes('tickets') ? 'flex' : 'none';
            document.getElementById('sidebarInquiryBtn').style.display = perms.includes('inquiry') ? 'flex' : 'none';
            document.getElementById('sidebarAttendanceBtn').style.display = perms.includes('attendance') ? 'flex' : 'none';
            document.getElementById('sidebarAdminBtn').style.display = perms.includes('admin') ? 'flex' : 'none';
            document.getElementById('sidebarSeatsBtn').style.display = perms.includes('seat_manage') ? 'flex' : 'none';
        }

        // --- Page Navigation Listeners ---
        // Main Menu Buttons
        document.getElementById('goBookingBtn').onclick = () => {
            showPage(sectionSelectPage);
            renderSectionButtons();
        };
        document.getElementById('goAdminBtn').onclick = () => {
            showPage(adminPage);
            renderAdminCheckboxes();
            renderUsersTable();
        };
        document.getElementById('goSeatManageBtn').onclick = () => {
            showPage(seatManagePage);
            updateSeatCounts();
            renderSeatManageTable();
        };
        document.getElementById('goInquiryBtn').onclick = () => {
            showPage(inquiryPage);
            document.getElementById('inquiryInput').value = '';
            document.getElementById('inquiryResult').innerHTML = '';
        };
        document.getElementById('goTicketsBtn').onclick = () => {
            showPage(ticketsPage);
            document.getElementById('sellTicketForm').reset();
            document.getElementById('ticketResult').innerHTML = '';
            document.getElementById('ticketSeatNumber').innerHTML = '<option value="">Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ</option>';
        };
        document.getElementById('goAttendanceBtn').onclick = () => {
            showPage(attendancePage);
            document.getElementById('attendanceForm').reset();
            document.getElementById('attendanceResult').innerHTML = '';
        };
        
        // Sidebar Buttons
        document.getElementById('sidebarMenuBtn').onclick = () => showPage(mainMenuPage);
        document.getElementById('sidebarBookingBtn').onclick = () => {
            showPage(sectionSelectPage);
            renderSectionButtons();
        };
        document.getElementById('sidebarAdminBtn').onclick = () => {
            showPage(adminPage);
            renderAdminCheckboxes();
            renderUsersTable();
        };
        document.getElementById('sidebarSeatsBtn').onclick = () => {
            showPage(seatManagePage);
            updateSeatCounts();
            renderSeatManageTable();
        };
        document.getElementById('sidebarInquiryBtn').onclick = () => {
            showPage(inquiryPage);
            document.getElementById('inquiryInput').value = '';
            document.getElementById('inquiryResult').innerHTML = '';
        };
        document.getElementById('sidebarTicketsBtn').onclick = () => {
            showPage(ticketsPage);
            document.getElementById('sellTicketForm').reset();
            document.getElementById('ticketResult').innerHTML = '';
            document.getElementById('ticketSeatNumber').innerHTML = '<option value="">Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ</option>';
        };
        document.getElementById('sidebarAttendanceBtn').onclick = () => {
            showPage(attendancePage);
            document.getElementById('attendanceForm').reset();
            document.getElementById('attendanceResult').innerHTML = '';
        };

        // Back Buttons
        document.querySelectorAll('[id^="backToMenuFrom"]').forEach(btn => {
            btn.onclick = () => showPage(mainMenuPage);
        });
        document.getElementById('backToSectionsBtn').onclick = () => showPage(sectionSelectPage);
        
        // --- Section Selection ---
        function renderSectionButtons() {
            const sectionBtns = document.getElementById('sectionBtns');
            sectionBtns.innerHTML = '';
            if (!currentUser) return;
            
            const sections = Array.isArray(currentUser.section) ? currentUser.section : [currentUser.section];
            sections.forEach(sec => {
                const btn = document.createElement('button');
                btn.className = 'icon-btn';
                btn.setAttribute('data-section', sec);
                btn.innerHTML = `<span class="icon">${sec}</span> Ø§Ù„Ù‚Ø³Ù… ${sec}`;
                btn.style.background = '#ffd700';
                btn.style.color = '#333';
                sectionBtns.appendChild(btn);
                
                btn.onclick = () => {
                    currentSection = sec;
                    showPage(mainPage);
                    document.getElementById('mainTitle').textContent = `Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø³Ø±Ø­ - Ø§Ù„Ù‚Ø³Ù… ${currentSection}`;
                    renderSection(currentSection);
                };
            });
        }
        
        // --- Seat Management ---
        function updateSeatCounts() {
            document.getElementById('countA').textContent = `(${seatsData.A.length} ÙƒØ±Ø³ÙŠ)`;
            document.getElementById('countB').textContent = `(${seatsData.B.length} ÙƒØ±Ø³ÙŠ)`;
            document.getElementById('countC').textContent = `(${seatsData.C.length} ÙƒØ±Ø³ÙŠ)`;
        }
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ Ù…Ù† Firebase Ù‚Ø¨Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
firebase.database().ref("chairs").once("value").then(snapshot => {
  const data = snapshot.val();
  if (!data) return;

  // Ù†ÙØ±Ù‘Øº seatsData
  seatsData = { A: [], B: [], C: [] };

  // Ù†ÙˆØ²Ù‘Ø¹ Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
  Object.keys(data).forEach(seatId => {
    const seat = data[seatId];
    const section = seat.section || 'A'; // Ø£Ùˆ B Ø£Ùˆ C
    seatsData[section].push({
      number: seatId,
      owner: seat.owner || '',
      mobile: seat.mobile || ''
    });
  });

  // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
  renderSeatManageTable();
});

        function renderSeatManageTable() {
            let html = '<table class="seat-table">';
            html += '<tr><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</th><th>Ø­Ø°Ù</th></tr>';
            ['A','B','C'].forEach(sec => {
                seatsData[sec].forEach(seat => {
                    html += `<tr>
                        <td>${sec}</td>
                        <td>${seat.number}</td>
                        <td>${seat.owner||''}</td>
                        <td>${seat.mobile||''}</td>
                        <td><button class='deleteSeatBtn' data-section='${sec}' data-number='${seat.number}'>ğŸ—‘ï¸</button></td>
                    </tr>`;
                });
            });
            html += '</table>';
            document.getElementById('seatManageTableContainer').innerHTML = html;
            
            document.querySelectorAll('.deleteSeatBtn').forEach(btn => {
                btn.onclick = function() {
                    const sec = this.getAttribute('data-section');
                    const num = parseInt(this.getAttribute('data-number'),10);
                    const seat = seatsData[sec][num-1];
                    if(!seat.owner) { alert('Ø§Ù„ÙƒØ±Ø³ÙŠ ØºÙŠØ± Ù…Ø­Ø¬ÙˆØ²'); return; }
                    if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„ÙƒØ±Ø³ÙŠØŸ')) {
                        seat.owner = '';
                        seat.mobile = '';
                        seat.bookedAt = '';
                        seat.leftAt = '';
                      firebase.database().ref("chairs").once("value").then(snapshot => {
  const data = snapshot.val();
  if (!data) return;

  seatsData = { A: [], B: [], C: [] };

  Object.keys(data).forEach(seatId => {
    const seat = data[seatId];
    const section = seat.section || 'A';
    seatsData[section].push({
      number: seatId,
      owner: seat.owner || '',
      mobile: seat.mobile || ''
    });
  });

  updateSeatCounts();
  renderSeatManageTable();
});

                    }
                };
            });
        }
        
        // Add/Remove Seats
        document.getElementById('addSeatA').onclick = function() {
            seatsData.A.push({ number: seatsData.A.length+1, owner: '', mobile: '', bookedAt: '', leftAt: '' });
            updateSeatCounts();
            renderSeatManageTable();
        };
        document.getElementById('removeSeatA').onclick = function() {
            if(seatsData.A.length<=1) return alert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ù‚Ù‰ ÙƒØ±Ø³ÙŠ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!');
            const last = seatsData.A[seatsData.A.length-1];
            if(last.owner) { if(!confirm('Ø¢Ø®Ø± ÙƒØ±Ø³ÙŠ Ù…Ø­Ø¬ÙˆØ²ØŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°ÙÙ‡ØŸ')) return; }
            seatsData.A.pop();
            updateSeatCounts();
            renderSeatManageTable();
        };
        document.getElementById('addSeatB').onclick = function() {
            seatsData.B.push({ number: seatsData.B.length+1, owner: '', mobile: '', bookedAt: '', leftAt: '' });
            updateSeatCounts();
            renderSeatManageTable();
        };
        document.getElementById('removeSeatB').onclick = function() {
            if(seatsData.B.length<=1) return alert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ù‚Ù‰ ÙƒØ±Ø³ÙŠ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!');
            const last = seatsData.B[seatsData.B.length-1];
            if(last.owner) { if(!confirm('Ø¢Ø®Ø± ÙƒØ±Ø³ÙŠ Ù…Ø­Ø¬ÙˆØ²ØŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°ÙÙ‡ØŸ')) return; }
            seatsData.B.pop();
            updateSeatCounts();
            renderSeatManageTable();
        };
        document.getElementById('addSeatC').onclick = function() {
            seatsData.C.push({ number: seatsData.C.length+1, owner: '', mobile: '', bookedAt: '', leftAt: '' });
            updateSeatCounts();
            renderSeatManageTable();
        };
        document.getElementById('removeSeatC').onclick = function() {
            if(seatsData.C.length<=1) return alert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ù‚Ù‰ ÙƒØ±Ø³ÙŠ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!');
            const last = seatsData.C[seatsData.C.length-1];
            if(last.owner) { if(!confirm('Ø¢Ø®Ø± ÙƒØ±Ø³ÙŠ Ù…Ø­Ø¬ÙˆØ²ØŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°ÙÙ‡ØŸ')) return; }
            seatsData.C.pop();
            updateSeatCounts();
            renderSeatManageTable();
        };
        
        // Manual Seat Addition
        document.getElementById('addSeatManualForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const sec = document.getElementById('manualSection').value;
            const number = parseInt(document.getElementById('manualSeatNumber').value,10);
            const owner = document.getElementById('manualOwnerName').value.trim();
            const mobile = document.getElementById('manualMobileNumber').value.trim();
            if(!sec || !number || !owner || !mobile) return;
            if(number<1 || number>20) { alert('Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 20'); return; }
            const seat = seatsData[sec][number-1];
            if(seat.owner) { if(!confirm('Ù‡Ø°Ø§ Ø§Ù„ÙƒØ±Ø³ÙŠ Ù„Ù‡ Ù…Ø§Ù„Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ØŸ')) return; }
            seat.owner = owner;
            seat.mobile = mobile;
            seat.bookedAt = new Date().toLocaleString('ar-EG');
            seat.leftAt = '';
            renderSeatManageTable();
            this.reset();
        });
        
        // Export to PDF
        document.getElementById('exportSeatsPdfBtn').addEventListener('click', function() {
            loadJsPDF(() => exportAllSeatsToPDF());
        });
        
        function exportAllSeatsToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'a4' });
            doc.setFontSize(22);
            doc.setTextColor(40, 40, 40);
            doc.text('Ø³Ø¬Ù„ Ø¬Ù…ÙŠØ¹ ÙƒØ±Ø§Ø³ÙŠ Ø§Ù„Ù…Ø³Ø±Ø­', doc.internal.pageSize.getWidth() / 2, 40, { align: 'center' });
            let y = 80;
            ['A','B','C'].forEach(sec => {
                doc.setFontSize(15);
                doc.setTextColor(80,80,80);
                doc.text(`Ø§Ù„Ù‚Ø³Ù… ${sec}`, 60, y);
                y += 20;
                doc.setFontSize(12);
                doc.setTextColor(0,0,0);
                doc.text('Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ', 120, y);
                doc.text('Ø§Ù„Ø§Ø³Ù…', 220, y);
                doc.text('Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„', 320, y);
                y += 16;
                seatsData[sec].forEach(seat => {
                    doc.text(String(seat.number), 120, y);
                    doc.text(seat.owner||'', 220, y);
                    doc.text(seat.mobile||'', 320, y);
                    y += 14;
                });
                y += 10;
            });
            doc.save('Ø³Ø¬Ù„-Ø¬Ù…ÙŠØ¹-Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ.pdf');
        }
        
        // --- Seat Management in Main Page ---
        function renderSection(section) {
            const sectionsDiv = document.getElementById('sections');
            sectionsDiv.innerHTML = '';
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'section';
            sectionDiv.innerHTML = `<div class="section-title">Ø§Ù„Ù‚Ø³Ù… ${section}</div>`;
            const seatsDiv = document.createElement('div');
            seatsDiv.className = 'seats';
            seatsData[section].forEach(seat => {
                const seatDiv = document.createElement('div');
                seatDiv.className = 'seat';
                seatDiv.innerHTML = `#${seat.number}` + (seat.owner ? `<span class="owner">${seat.owner}</span>` : '');
                if (seat.owner) {
                    seatDiv.style.cursor = 'pointer';
                    seatDiv.title = 'Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ±Ø³ÙŠ';
                    seatDiv.addEventListener('click', function() {
                        let info = `Ø§Ù„ÙƒØ±Ø³ÙŠ Ø±Ù‚Ù…: ${seat.number}\nØ§Ù„Ø§Ø³Ù…: ${seat.owner}\nØ§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„: ${seat.mobile}`;
                        if (seat.bookedAt) info += `\nÙˆÙ‚Øª Ø§Ù„Ø­Ø¬Ø²: ${seat.bookedAt}`;
                        if (seat.leftAt) info += `\nÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬: ${seat.leftAt}`;
                        info += '\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø®Ø±Ø§Ø¬ ØµØ§Ø­Ø¨ Ø§Ù„ÙƒØ±Ø³ÙŠØŸ';
                        if (confirm(info)) {
                            seat.leftAt = new Date().toLocaleString('ar-EG');
                            seat.owner = '';
                            seat.mobile = '';
                            renderSection(section);
                        }
                    });
                }
                seatsDiv.appendChild(seatDiv);
            });
            sectionDiv.appendChild(seatsDiv);
            sectionsDiv.appendChild(sectionDiv);
        }
        
        // Add Seat in Main Page
        document.getElementById('addSeatForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!currentSection) return;
            const number = parseInt(document.getElementById('seatNumber').value, 10);
            const owner = document.getElementById('ownerName').value.trim();
            const mobile = document.getElementById('mobileNumber').value.trim();
            if (!owner || !number || !mobile) return;
            if (number < 1 || number > 20) {
                alert('Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 20');
                return;
            }
            const seat = seatsData[currentSection][number - 1];
            if (seat.owner) {
                if (!confirm('Ù‡Ø°Ø§ Ø§Ù„ÙƒØ±Ø³ÙŠ Ù„Ù‡ Ù…Ø§Ù„Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ø§Ù„ÙƒØŸ')) {
                    return;
                }
            }
            seat.owner = owner;
            seat.mobile = mobile;
            seat.bookedAt = new Date().toLocaleString('ar-EG');
            seat.leftAt = '';
            renderSection(currentSection);
            this.reset();
        });
        
        // --- Log Modal ---
        document.getElementById('showLogBtn').addEventListener('click', function() {
            if (!currentSection) return;
            const data = seatsData[currentSection].map(seat => seat).filter(seat => seat.owner || seat.bookedAt || seat.leftAt);
            if (data.length === 0) {
                document.getElementById('logTableContainer').innerHTML = '<div style="text-align:center; color:#b00;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù….</div>';
            } else {
                let table = '<table class="result-table">';
                table += '<tr><th>Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</th><th>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¬Ø²</th><th>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th></tr>';
                data.forEach(seat => {
                    table += `<tr>
                        <td>${seat.number}</td>
                        <td>${seat.owner}</td>
                        <td>${seat.mobile}</td>
                        <td>${seat.bookedAt || ''}</td>
                        <td>${seat.leftAt || ''}</td>
                    </tr>`;
                });
                table += '</table>';
                document.getElementById('logTableContainer').innerHTML = table;
            }
            logModal.style.display = 'flex';
        });
        
        document.getElementById('closeLogBtn').addEventListener('click', function() {
            logModal.style.display = 'none';
        });
        
        document.getElementById('exportPdfBtn').addEventListener('click', function() {
            loadJsPDF(() => exportSectionLogToPDF(currentSection));
        });
        
        function exportSectionLogToPDF(section) {
            const { jsPDF } = window.jspdf;
            const data = seatsData[section].map(seat => seat).filter(seat => seat.owner || seat.bookedAt || seat.leftAt);
            const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'a4' });
            // Ø®Ù„ÙÙŠØ© Ù…Ù„ÙˆÙ†Ø©
            doc.setFillColor(255, 215, 0);
            doc.rect(0, 0, doc.internal.pageSize.getWidth(), 60, 'F');
            // Ø¹Ù†ÙˆØ§Ù†
            doc.setFontSize(22);
            doc.setTextColor(40, 40, 40);
            doc.text(`Ø³Ø¬Ù„ ÙƒØ±Ø§Ø³ÙŠ Ø§Ù„Ù‚Ø³Ù… ${section}`, doc.internal.pageSize.getWidth() / 2, 40, { align: 'center' });
            // Ø±Ø³Ù… Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙƒØ±Ø³ÙŠ
            doc.setDrawColor(80, 80, 80);
            doc.setFillColor(255, 180, 50);
            doc.ellipse(60, 45, 18, 12, 'FD');
            doc.setFillColor(255, 215, 0);
            doc.rect(50, 55, 20, 18, 'F');
            // Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const headers = ['Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„', 'ÙˆÙ‚Øª Ø§Ù„Ø­Ø¬Ø²', 'ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬'];
            const startY = 90;
            let y = startY;
            doc.setFontSize(13);
            doc.setTextColor(255,255,255);
            doc.setFillColor(65, 67, 69);
            doc.rect(40, y, 720, 28, 'F');
            headers.forEach((h, i) => {
                doc.text(h, 60 + i*140, y+19, { align: 'right' });
            });
            y += 32;
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
            data.forEach((seat, idx) => {
                // ØµÙÙˆÙ Ù…Ù„ÙˆÙ†Ø© Ø¨Ø§Ù„ØªØ¨Ø§Ø¯Ù„
                if (idx % 2 === 0) doc.setFillColor(255, 243, 200);
                else doc.setFillColor(255, 255, 255);
                doc.rect(40, y-2, 720, 26, 'F');
                doc.setTextColor(40,40,40);
                doc.text(String(seat.number), 60, y+15, { align: 'right' });
                doc.text(seat.owner || '', 200, y+15, { align: 'right' });
                doc.text(seat.mobile || '', 340, y+15, { align: 'right' });
                doc.text(seat.bookedAt || '', 480, y+15, { align: 'right' });
                doc.text(seat.leftAt || '', 620, y+15, { align: 'right' });
                y += 28;
            });
            // ØªØ°ÙŠÙŠÙ„
            doc.setFontSize(10);
            doc.setTextColor(120,120,120);
            doc.text('ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ù…Ù† Ù†Ø¸Ø§Ù… Ø­Ø¬Ø² ÙƒØ±Ø§Ø³ÙŠ Ù…Ø³Ø±Ø­ Ø§Ù„ÙˆØ§ÙŠ', doc.internal.pageSize.getWidth() / 2, doc.internal.pageSize.getHeight() - 20, { align: 'center' });
            doc.save(`Ø³Ø¬Ù„-ÙƒØ±Ø§Ø³ÙŠ-Ø§Ù„Ù‚Ø³Ù…-${section}.pdf`);
        }
        
        // --- Admin Page ---
        function renderAdminCheckboxes() {
            const sectionsDiv = document.getElementById('adminSectionsCheckboxes');
            sectionsDiv.innerHTML = '<label style="font-size:1em;">Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§:</label>';
            ['A','B','C'].forEach(sec => {
                const label = document.createElement('label');
                label.innerHTML = `<input type="checkbox" name="section${sec}" value="${sec}"> ${sec}`;
                sectionsDiv.appendChild(label);
            });
            
            const permsDiv = document.getElementById('adminPermissionsCheckboxes');
            permsDiv.innerHTML = '<label style="font-size:1em;">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:</label>';
            PERMISSIONS.forEach(perm => {
                const label = document.createElement('label');
                label.innerHTML = `<input type="checkbox" id="perm_${perm.key}" value="${perm.key}"> ${perm.label}`;
                permsDiv.appendChild(label);
            });
        }
        
        function renderUsersTable() {
            let html = '<table class="seat-table">';
            html += '<tr><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</th><th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</th><th>Ø­Ø°Ù</th></tr>';
            Object.keys(USERS).forEach(u => {
                html += `<tr>
                    <td>${u}</td>
                    <td>`;
                ['A','B','C'].forEach(sec => {
                    const checked = USERS[u].section.includes(sec) ? 'checked' : '';
                    const disabled = u==='filo' ? 'disabled' : '';
                    html += `<label style='margin-left:8px;'><input type='checkbox' class='user-section-checkbox' data-user='${u}' value='${sec}' ${checked} ${disabled}> ${sec}</label>`;
                });
                html += `</td><td>`;
                PERMISSIONS.forEach(p => {
                    const checked = USERS[u].permissions && USERS[u].permissions.includes(p.key) ? 'checked' : '';
                    const disabled = u==='filo' && p.key==='admin' ? 'checked disabled' : (u==='filo' ? 'disabled' : '');
                    html += `<label style='margin-left:8px;'><input type='checkbox' class='user-perm-checkbox' data-user='${u}' value='${p.key}' ${checked} ${disabled}> ${p.label}</label>`;
                });
                html += `</td>
                    <td><button class='deleteUserBtn' data-user='${u}' ${u==='filo'?'disabled':''}>ğŸ—‘ï¸</button></td>
                </tr>`;
            });
            html += '</table>';
            document.getElementById('usersTableContainer').innerHTML = html;
            
            // Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…
            document.querySelectorAll('.deleteUserBtn').forEach(btn => {
                btn.onclick = function() {
                    const user = this.getAttribute('data-user');
                    if(user==='filo') { alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ'); return; }
                    delete USERS[user];
                    renderUsersTable();
                };
            });
            
            // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§
            document.querySelectorAll('.user-section-checkbox').forEach(chk => {
                chk.onchange = function() {
                    const user = this.getAttribute('data-user');
                    if(user==='filo') return;
                    const sec = this.value;
                    if(this.checked) {
                        if(!USERS[user].section.includes(sec)) USERS[user].section.push(sec);
                    } else {
                        USERS[user].section = USERS[user].section.filter(s => s!==sec);
                        if(USERS[user].section.length===0) {
                            alert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ù‚Ø³Ù… ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!');
                            this.checked = true;
                            USERS[user].section.push(sec);
                        }
                    }
                };
            });
            
            // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            document.querySelectorAll('.user-perm-checkbox').forEach(chk => {
                chk.onchange = function() {
                    const user = this.getAttribute('data-user');
                    if(user==='filo' && this.value==='admin') return;
                    if(!USERS[user].permissions) USERS[user].permissions = [];
                    if(this.checked) {
                        if(!USERS[user].permissions.includes(this.value)) USERS[user].permissions.push(this.value);
                    } else {
                        USERS[user].permissions = USERS[user].permissions.filter(p => p!==this.value);
                    }
                };
            });
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
        document.getElementById('addUserForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value;
            const sections = [];
            if(document.querySelector('input[name="sectionA"]').checked) sections.push('A');
            if(document.querySelector('input[name="sectionB"]').checked) sections.push('B');
            if(document.querySelector('input[name="sectionC"]').checked) sections.push('C');
            // ØµÙ„Ø§Ø­ÙŠØ§Øª
            const permissions = [];
            PERMISSIONS.forEach(p => {
                if(document.getElementById('perm_'+p.key)?.checked) permissions.push(p.key);
            });
            if(!username || !password || sections.length===0) return;
            if(USERS[username]) { alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„'); return; }
            USERS[username] = { password, section: sections, permissions };
            renderUsersTable();
            this.reset();
        });
        
        // --- Inquiry Page ---
        document.getElementById('inquiryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const q = document.getElementById('inquiryInput').value.trim();
            const resultDiv = document.getElementById('inquiryResult');
            if (!q) { resultDiv.innerHTML = '<span style="color:#b00">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ÙƒØ±Ø³ÙŠ Ø£Ùˆ Ø§Ø³Ù… Ø£Ùˆ Ù…ÙˆØ¨Ø§ÙŠÙ„</span>'; return; }
            let found = [];
            Object.keys(seatsData).forEach(section => {
                seatsData[section].forEach(seat => {
                    if (
                        seat.number.toString() === q ||
                        (seat.owner && seat.owner.includes(q)) ||
                        (seat.mobile && seat.mobile.includes(q))
                    ) {
                        found.push({ ...seat, section });
                    }
                });
            });
            if (found.length === 0) {
                resultDiv.innerHTML = '<span style="color:#b00">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</span>';
            } else {
                let html = '<table class="result-table">';
                html += '<tr><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</th><th>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¬Ø²</th><th>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th></tr>';
                found.forEach(seat => {
                    html += `<tr>
                        <td>${seat.section}</td>
                        <td>${seat.number}</td>
                        <td>${seat.owner}</td>
                        <td>${seat.mobile}</td>
                        <td>${seat.bookedAt || ''}</td>
                        <td>${seat.leftAt || ''}</td>
                    </tr>`;
                });
                html += '</table>';
                resultDiv.innerHTML = html;
            }
        });
        
        // --- Tickets Page ---
        document.getElementById('ticketSection').addEventListener('change', function() {
            const section = this.value;
            const seatSelect = document.getElementById('ticketSeatNumber');
            seatSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ</option>';
            if (!section || !seatsData[section]) return;
            seatsData[section].forEach(seat => {
                if (!seat.owner) {
                    const opt = document.createElement('option');
                    opt.value = seat.number;
                    opt.textContent = seat.number;
                    seatSelect.appendChild(opt);
                }
            });
        });
        
        document.getElementById('sellTicketForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('ticketBuyerName').value.trim();
            const mobile = document.getElementById('ticketBuyerMobile').value.trim();
            const section = document.getElementById('ticketSection').value;
            const seatNumber = parseInt(document.getElementById('ticketSeatNumber').value, 10);
            if (!name || !mobile || !section || !seatNumber) return;
            // ØªØ­Ù‚Ù‚ Ø£Ù† Ø§Ù„ÙƒØ±Ø³ÙŠ Ù…Ø§Ø²Ø§Ù„ Ù…ØªØ§Ø­
            const seat = seatsData[section][seatNumber - 1];
            if (seat.owner) {
                document.getElementById('ticketResult').innerHTML = '<span style="color:#b00">Ù‡Ø°Ø§ Ø§Ù„ÙƒØ±Ø³ÙŠ Ù…Ø­Ø¬ÙˆØ² Ø¨Ø§Ù„ÙØ¹Ù„</span>';
                return;
            }
            // Ø­Ø¬Ø² Ø§Ù„ÙƒØ±Ø³ÙŠ ÙØ¹Ù„ÙŠÙ‹Ø§
            seat.owner = name;
            seat.mobile = mobile;
            seat.bookedAt = new Date().toLocaleString('ar-EG');
            seat.leftAt = '';
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ°ÙƒØ±Ø© Ù„Ù„Ø³Ø¬Ù„
            const ticket = {
                serial: ticketSerial++,
                name,
                mobile,
                section,
                seatNumber,
                soldAt: new Date().toLocaleString('ar-EG')
            };
            soldTickets.push(ticket);
            document.getElementById('ticketResult').innerHTML = `<div style='color:#080; font-weight:bold;'>ØªÙ… Ø¨ÙŠØ¹ Ø§Ù„ØªØ°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­<br>Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©: ${ticket.serial}<br>Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Ø³ÙŠ: ${seatNumber}</div>`;
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ
            const seatSelect = document.getElementById('ticketSeatNumber');
            seatSelect.querySelector(`option[value='${seatNumber}']`)?.remove();
        });
        
        // --- Attendance Page ---
        document.getElementById('attendanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const q = document.getElementById('attendanceName').value.trim();
            if (!q) {
                document.getElementById('attendanceResult').innerHTML = '<span style="color:#b00">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„</span>';
                return;
            }
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙƒØ±Ø§Ø³ÙŠ ÙˆØ§Ù„ØªØ°Ø§ÙƒØ±
            let found = null;
            let type = '';
            Object.keys(seatsData).forEach(section => {
                seatsData[section].forEach(seat => {
                    if ((seat.owner && seat.owner.includes(q)) || (seat.mobile && seat.mobile.includes(q))) {
                        found = { name: seat.owner, mobile: seat.mobile, section, source: 'seat' };
                        type = 'seat';
                    }
                });
            });
            if (!found) {
                for (let t of soldTickets) {
                    if (t.name.includes(q) || t.mobile.includes(q)) {
                        found = { name: t.name, mobile: t.mobile, section: t.section, source: 'ticket' };
                        type = 'ticket';
                        break;
                    }
                }
            }
            if (!found) {
                document.getElementById('attendanceResult').innerHTML = '<span style="color:#b00">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø®Øµ</span>';
                return;
            }
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù
            let last = attendanceLog.length > 0 ? attendanceLog[attendanceLog.length-1] : null;
            let action = 'Ø¯Ø®ÙˆÙ„';
            if (last && last.name === found.name && last.mobile === found.mobile && last.action === 'Ø¯Ø®ÙˆÙ„') {
                action = 'Ø§Ù†ØµØ±Ø§Ù';
            }
            attendanceLog.push({
                name: found.name,
                mobile: found.mobile,
                section: found.section,
                action,
                time: new Date().toLocaleString('ar-EG'),
                source: found.source
            });
            document.getElementById('attendanceResult').innerHTML = `<div style='color:#080; font-weight:bold;'>ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${action} Ø¨Ù†Ø¬Ø§Ø­<br>Ø§Ù„Ø§Ø³Ù…: ${found.name}<br>Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„: ${found.mobile}<br>Ø§Ù„Ù‚Ø³Ù…: ${found.section}</div>`;
        });
        
        // --- Load jsPDF ---
        let jsPDFLoaded = false;
        function loadJsPDF(callback) {
            if (jsPDFLoaded) return callback();
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
            script.onload = function() { 
                jsPDFLoaded = true; 
                callback(); 
            };
            document.body.appendChild(script);
        }
        
        // Initialize
        showPage(loginPage);
    });
    </script>
</body>
</html>